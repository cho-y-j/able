# ABLE Platform - Work Log (2026-02-16)

## Project Summary

ABLE (AI-Based auto-trading platform) - Korean stock market automated trading system using KIS API.

| Category | Metric |
|----------|--------|
| Backend code | 22,011 lines (Python) |
| Frontend code | 15,305 lines (TypeScript/React) |
| Backend tests | 873 tests (pytest) |
| Frontend tests | 357 tests (jest) |
| Backend test code | 14,162 lines |
| Frontend test code | 6,514 lines |
| **Total tests** | **1,230** |
| Dashboard pages | 13 pages |
| API routes | 13 route modules |

---

## Architecture

### Backend
- **Framework**: FastAPI + SQLAlchemy async + Celery + Redis (16379) + PostgreSQL (15432)
- **AI Integration**: GPT-4o (briefing/news), DeepSeek (technical analysis)
- **Broker API**: Korea Investment Securities (KIS) REST + WebSocket
- **Security**: AES-256 credential encryption, JWT auth

### Frontend
- **Framework**: Next.js 16 + React 19 + TypeScript + Tailwind CSS
- **State**: Zustand (trading, auth, theme stores)
- **i18n**: Korean/English full support
- **Theme**: Dark/Light/System mode

---

## Completed Features (Chronological)

### Phase 1: TradingRecipe System (`5a96e20`)
- Multi-signal composition engine (RSI, MACD, volume spike, VWAP deviation, KIS condition search)
- Signal combinator modes: AND, OR, MIN_AGREE, WEIGHTED
- Recipe builder UI with drag-and-drop signal configuration
- Real-time monitoring foundation

### Phase 2: Bug Fixes & Stability (`ceb8f51`)
- Critical bug fixes across platform
- Database migration scripts
- Frontend test infrastructure
- Error handling improvements

### Phase 3: Periodic Monitoring (`d3fec90`)
- Celery periodic tasks for recipe signal monitoring
- KIS condition search integration
- Automated signal detection pipeline

### Phase 4: Backtest Visualization (`85a478c`)
- Equity curve chart (lightweight-charts)
- Trade log with entry/exit visualization
- Performance metrics display

### Phase 5: Notification Pipeline (`e54c335`)
- Recipe signal notifications
- Condition match alerts
- WebSocket notification delivery

### Phase 6: Live Trading Integration (`f6026d5`)
- RecipeExecutor service
- Execution API endpoints
- Order history tracking

### Phase 7: WebSocket Real-time Pipeline (`682f19a`)
- KIS WebSocket bridge for live market data
- Real-time dashboard updates
- Recipe signal streaming

### Phase 8: Recipe Performance Dashboard (`5901af1`)
- P&L analytics with daily breakdown
- Equity curve visualization
- Trade history with statistics

### Phase 9: Portfolio Rebalancing (`d2c7dbe`)
- Recipe allocation tracking
- Stock conflict detection across recipes
- Rebalancing suggestions with delta calculations

### Phase 10: Recipe-Strategy Integration (`bacd997`)
- Strategy page flows into recipe creation
- Auto-trading button replaced with recipe workflow

### Phase 11: Notification Wiring (`f944710`)
- Notifications connected to critical event triggers
- Agent, order, position, and system events

### Phase 12: Backtest Comparison (`4134828`)
- Multi-strategy comparison dashboard
- Checkbox selection for comparing recipes
- Equity curve overlay chart

### Phase 13: AI Analysis Page (`de51293`)
- Standalone stock analysis page
- Market briefing (pre-market/closing)
- Sentiment analysis display

### Phase 14: Recipe Monitoring Dashboard (`d6cf47a`)
- Real-time recipe status monitoring
- WebSocket-powered live updates
- Signal detection indicators

### Phase 15: Backtest Comparison Enhancement (`2451b51`)
- Equity curve overlay improvements
- Recipe-based backtest comparison

### Phase 16: Portfolio Treemap Heatmap (`105bcde`)
- Squarified layout algorithm
- Color-coded P&L visualization
- Interactive position display

### Phase 17: Dashboard Home Enhancement (`692aa83`)
- Portfolio treemap integration
- Active recipes summary
- Recent activity feed

### Phase 18: Settings Page Enhancement (`0400268`)
- Full i18n (Korean/English)
- Connection status badges (Verified/Not verified with timestamp)
- Delete confirmation dialog
- Per-key validation loading state
- KIS account number display
- 15 settings tests

### Phase 19: Trading, Agents, Integration Tests, Dark Mode (`a878086`)

#### Trading Page Enhancement
- Quick Order panel with buy/sell form
- Order confirm dialog
- Auto-fill stock code from selected position
- Order type (market/limit) and side (buy/sell) toggles
- i18n for all strings (14 new keys)
- 13 tests

#### Agent Page Enhancement
- Session management (start/stop)
- Pending approvals with approve/reject buttons (HITL workflow)
- Activity log with agent actions
- Current agent highlight
- Session details (type, iterations, regime)
- i18n for all strings (11 new keys)
- 16 tests

#### Backend Integration Tests
- Recipe API: 9 tests (CRUD, activation/deactivation, clone, backtest, performance)
- Market Data API: 6 tests (price, OHLCV, error handling, daily reports, balance)
- API Keys API: 8 tests (list, create KIS/LLM, validation, deletion)
- **27 integration tests total**

#### Dark Mode / Theme System
- Zustand store with localStorage persist (`frontend/src/store/theme.ts`)
- `applyTheme()` sets CSS class + data-theme attribute
- Dark / Light / System toggle in sidebar
- Respects system preference for "system" mode
- 8 tests

### Phase 20: Gitignore Cleanup (`e2e86f2`)
- Added celerybeat-schedule-shm/wal to .gitignore

---

## Dashboard Pages (13)

| Page | Description |
|------|-------------|
| `/dashboard` | Home - portfolio overview, treemap, active recipes, activity feed |
| `/dashboard/market` | Market data - stock search, price, OHLCV chart, indices |
| `/dashboard/strategies` | AI strategy search, my strategies list |
| `/dashboard/analysis` | AI stock analysis, market briefing |
| `/dashboard/recipes` | Recipe builder, monitoring, live signals |
| `/dashboard/backtests` | Backtest results, multi-strategy comparison |
| `/dashboard/trading` | Live trading, quick order, positions, orders |
| `/dashboard/paper` | Paper trading sessions |
| `/dashboard/portfolio` | Portfolio analytics, rebalancing, risk |
| `/dashboard/risk` | VaR analysis, stress tests, Monte Carlo |
| `/dashboard/agents` | AI agent team, HITL approvals, activity log |
| `/dashboard/notifications` | Notification center, category filters |
| `/dashboard/settings` | API keys (KIS/LLM), language, theme |

## API Routes (13 modules)

| Module | Key Endpoints |
|--------|--------------|
| `auth.py` | Register, login, refresh, me |
| `strategies.py` | CRUD, AI search, auto-trading toggle |
| `recipes.py` | CRUD, activate/deactivate, clone, backtest, performance, execute |
| `trading.py` | Orders, positions, portfolio stats |
| `market_data.py` | Price, OHLCV, minute data, MTF analysis, indices, daily reports |
| `agents.py` | Start/stop session, status, approvals |
| `analysis.py` | Stock analysis, market briefing |
| `backtests.py` | Results, comparison |
| `paper.py` | Paper trading sessions |
| `notifications.py` | List, mark read, preferences |
| `api_keys.py` | KIS/LLM credential management |
| `websocket.py` | Real-time data streaming |

---

## Test Coverage Summary

### Frontend Tests (357 tests, 33 suites)
- Pages: trading (13), agents (16), settings (15), portfolio (15), risk (8), market (7), login (7), register (6), notifications (5), backtests, analysis, recipes, paper
- Components: RecipeCard, ExecutionPanel, PerformancePanel, ParamAdjustTab, RebalancingTab, GradeBadge, ScoreGauge, Treemap
- Stores: theme (8), trading WebSocket
- Libraries: charts, ws, i18n

### Backend Tests (873 tests)
- Unit tests: signals, services, models, agents, API endpoints
- Integration tests: recipes API (9), market API (6), keys API (8), E2E flows

---

## Git Commit History (Latest 20)

```
e2e86f2 Add celerybeat-schedule-shm/wal to .gitignore
a878086 Add trading UX, agent HITL workflow, integration tests, and dark mode
0400268 Enhance settings page with i18n, connection status, and delete confirmation
692aa83 Enhance dashboard home with portfolio treemap, active recipes, and activity feed
105bcde Add portfolio treemap heatmap with squarified layout algorithm
2451b51 Add recipe backtest comparison page with equity curve overlay
d6cf47a Add real-time recipe monitoring dashboard with WebSocket integration
de51293 Add standalone AI analysis page with stock analysis and market briefing
4134828 Enhance backtest comparison dashboard with checkbox selection and equity curve overlay
f944710 Wire notification functions to critical event triggers
bacd997 Replace strategy auto-trading button with recipe creation flow
d2c7dbe Add portfolio rebalancing: recipe allocation tracking, conflict detection, and suggestions
5901af1 Add recipe performance dashboard with PnL analytics, equity curve, and trade history
682f19a Add WebSocket real-time pipeline: KIS WS bridge, live dashboard, recipe signals
f6026d5 Add live trading integration: RecipeExecutor, execution API, and order history
e54c335 Wire recipe signal and condition match notifications to periodic tasks
85a478c Add backtest visualization with equity curve chart and trade log
d3fec90 Implement periodic recipe monitoring and condition search tasks
ceb8f51 Fix critical bugs, add migration, frontend tests, and error handling
5a96e20 Add TradingRecipe system: multi-signal composition, recipe builder UI, real-time monitoring
```
